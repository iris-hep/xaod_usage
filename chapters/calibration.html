
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Calibration &#8212; Using the ATLAS xAOD ServiceX Backend</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/calibration';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Electron Collection" href="electrons.html" />
    <link rel="prev" title="The Jet Collection" href="jets.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Using the ATLAS xAOD ServiceX Backend - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Using the ATLAS xAOD ServiceX Backend - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Using the ATLAS xAOD Typed Backend
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Data Samples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The Calibrated Collections</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="jets.html">The Jet Collection</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Calibration</a></li>

<li class="toctree-l1"><a class="reference internal" href="electrons.html">The Electron Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="muons.html">The Muon Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="taus.html">The Tau Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="met.html">Missing <span class="math notranslate nohighlight">\(E_T\)</span></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Uncalibrated Collections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tracks.html">The Track Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertices.html">The Vertex Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="caloclusters.html">Calorimeter Clusters Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="trigger.html">Accessing the Trigger</a></li>
<li class="toctree-l1"><a class="reference internal" href="truth.html">The Truth Particles Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="eventinfo.html">Event Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="xaod_objects.html">Advanced, Common, Features</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/py_help.html">Using Python Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="old_access.html">Old Collection Access Pattern</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/errors.html">Understanding Errors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/gordonwatts/xaod_usage" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/gordonwatts/xaod_usage/issues/new?title=Issue%20on%20page%20%2Fchapters/calibration.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters/calibration.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Calibration</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Calibration</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-calibration-configuration-object">The Calibration Configuration Object</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modifying-the-calibrated-collection-in-the-query">Modifying the calibrated collection in the query</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#systematic-errors">Systematic Errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncalibrated-collections">Uncalibrated Collections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysisbase-configuration-code">AnalysisBase Configuration Code</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#further-information">Further Information</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="calibration">
<span id="ch-calibration"></span><h1>Calibration<a class="headerlink" href="#calibration" title="Link to this heading">#</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The examples on this page have not been updated to use r22 and ServiceX 3 yet.</p>
</div>
<p>In the previous <a class="reference internal" href="jets.html#ch-jets"><span class="std std-ref">chapter on jets</span></a>, the jet quantities were all calibrated. The common CP algorithms were used during extraction to:</p>
<ul class="simple">
<li><p>Calibrate the jets according to the most recent Jet group recommendations that were baked into the release</p></li>
<li><p>Calibrate all the other objects (electrons, photons, taus, and muons)</p></li>
<li><p>Perform overlap removal</p></li>
</ul>
<p>This chapter discusses the details of how calibrations are run, and what can be done to configure it. First, however, a short introduction on the calibration model to help understand the technical code.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>It is best to think of an event being calibrated in ATLAS, rather than a single object or collection of objects. In most cases it does not make sense to have one type of object calibrated while another isn’t. This is because there are interdependencies between some objects. For example, the calibrated jets, electrons, photons, muons, and taus are all used to calculate the missing <span class="math notranslate nohighlight">\(E_T\)</span> for an event. Further, after calibrating jets, electrons, photons, muons, and taus one must run overlap removal to disambiguate, say, jets and electrons. How that calibration is run is called the <em>calibration configuration</em>.</p>
<p>As a result, it only makes sense to talk about a coherent, calibrated set of objects in an ATLAS event. Further, due to limitations in how <code class="docutils literal notranslate"><span class="pre">AnalysisBase</span></code> (which extracts the data from xAOD’s and runs the common CP algorithms) and <code class="docutils literal notranslate"><span class="pre">func_adl</span></code>’s calibration model described here, it is not possible to run with more than a single calibration configuration in a single query. You’ll have to split them up into multiple queries.</p>
<p><code class="docutils literal notranslate"><span class="pre">func_adl</span></code> has calibration configuration class. It tells the system what jet collection to use, what muon working point to use, etc. This is configured by default to work well for <code class="docutils literal notranslate"><span class="pre">DAOD_PHYS</span></code>. In the end, the common CP algorithms are configured using the contents of configuration class. If you do nothing, the default configuration for <code class="docutils literal notranslate"><span class="pre">DAOD_PHYS</span></code> is what you’ll get. However, if you need a different calibration configuration it is possible to alter this, as we will see below.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Overlap Removal is disabled for all the tests in these notebooks. We need to figure out how to remove events with no found primary vertices as OR depends on those existing.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">ds_zee</span> <span class="k">as</span> <span class="n">ds</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">match_eta_phi</span>
<span class="kn">from</span> <span class="nn">func_adl_servicex_xaodr21</span> <span class="kn">import</span> <span class="n">calib_tools</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">awkward</span> <span class="k">as</span> <span class="nn">ak</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">ds_zee</span> <span class="k">as</span> <span class="n">ds</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">match_eta_phi</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">func_adl_servicex_xaodr21</span> <span class="kn">import</span> <span class="n">calib_tools</span>

<span class="ne">ImportError</span>: cannot import name &#39;ds_zee&#39; from &#39;config&#39; (/home/rjanusia/WorkingDirectory/IrisHep/xaod_usage/book/chapters/config.py)
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-calibration-configuration-object">
<h2>The Calibration Configuration Object<a class="headerlink" href="#the-calibration-configuration-object" title="Link to this heading">#</a></h2>
<p>The default calibration object details all the collections and working points that are to be used. The default configuration is easy enough to grab and inspect by accessing the <code class="docutils literal notranslate"><span class="pre">default_config</span></code> on the <code class="docutils literal notranslate"><span class="pre">calib_tools</span></code> object. The <code class="docutils literal notranslate"><span class="pre">calib_tools</span></code> object provides access to the configuration and helper methods to modify it in various ways.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">calib_tools</span><span class="o">.</span><span class="n">default_config</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CalibrationEventConfig(jet_collection=&#39;AntiKt4EMPFlowJets&#39;, jet_calib_truth_collection=&#39;AntiKt4TruthDressedWZJets&#39;, electron_collection=&#39;Electrons&#39;, electron_working_point=&#39;MediumLHElectron&#39;, electron_isolation=&#39;NonIso&#39;, photon_collection=&#39;Photons&#39;, photon_working_point=&#39;Tight&#39;, photon_isolation=&#39;FixedCutTight&#39;, muon_collection=&#39;Muons&#39;, muon_working_point=&#39;Medium&#39;, muon_isolation=&#39;NonIso&#39;, tau_collection=&#39;TauJets&#39;, tau_working_point=&#39;Tight&#39;, perform_overlap_removal=True)
</pre></div>
</div>
</div>
</div>
<p>When you request <code class="docutils literal notranslate"><span class="pre">Jet</span></code>’s, for example, you’ll be getting back fully calibrated and overlap pruned jets. The jets will have started from the <code class="docutils literal notranslate"><span class="pre">default_config.jet_collection</span></code> entry above (these are the same jets we saw in most of the <a class="reference internal" href="#sec-jet-simple"><span class="xref myst">Jet chapter</span></a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pflow_jets</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">Jets</span><span class="p">())</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="n">jets</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">))</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">eta</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">phi</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
        <span class="p">})</span>
        <span class="o">.</span><span class="n">AsAwkwardArray</span><span class="p">()</span>
        <span class="o">.</span><span class="n">value</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">pflow_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PFlow&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jet $p_T$ [GeV]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9737deb434d715c9bca8c6eb0006f8de8cb20835199141c0da95d69086d819a0.png" src="../_images/9737deb434d715c9bca8c6eb0006f8de8cb20835199141c0da95d69086d819a0.png" />
</div>
</div>
<p>You can change the default calibration configuration if you desire. If your analysis is based on a skim, rather than <code class="docutils literal notranslate"><span class="pre">DAOD_PHYS</span></code>, you might want to do this in some master configuration file that everyone includes.</p>
<p>All queries that occur after the change will this new default. Note that calibration configuration is captured at run time (when you use <code class="docutils literal notranslate"><span class="pre">value</span></code> or its equivalent), not when you use the <code class="docutils literal notranslate"><span class="pre">Jets</span></code> method, etc. If you find yourself wanting to use multiple configurations in the same script or notebook, modifying the default is almost certainly not the way to do (see below for other more flexible options).</p>
<p>This example modifies the default calibration configuration to use a new jet collection. The identical query above will return a different set of (calibrated) jets:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_jet_selection</span> <span class="o">=</span> <span class="n">calib_tools</span><span class="o">.</span><span class="n">default_config</span><span class="p">()</span>
<span class="n">new_jet_selection</span><span class="o">.</span><span class="n">jet_collection</span> <span class="o">=</span> <span class="s1">&#39;AntiKt4EMTopoJets&#39;</span>
<span class="n">calib_tools</span><span class="o">.</span><span class="n">set_default_config</span><span class="p">(</span><span class="n">new_jet_selection</span><span class="p">)</span>

<span class="n">antikt_jets_attempt</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span>
                       <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">Jets</span><span class="p">())</span>
                       <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="n">jets</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">))</span>
                       <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="p">{</span>
                               <span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                               <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">eta</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                               <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">phi</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                       <span class="p">})</span>
                       <span class="o">.</span><span class="n">AsAwkwardArray</span><span class="p">()</span>
                       <span class="o">.</span><span class="n">value</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>And we can see that the PFlow algorithm returns more jets than the anti-kt4 algorithm. And that they are mostly at lower jet <span class="math notranslate nohighlight">\(p_T\)</span>’s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">pflow_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">antikt_jets_attempt</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1108510, 1108510)
</pre></div>
</div>
</div>
</div>
<p>Wait - they are the same. What is going on here?</p>
<p>The actual reason is one why it is important not to use this feature except under very limited circumstances. If we look at the code that creates this dataset in <code class="docutils literal notranslate"><span class="pre">config.py</span></code>, we’ll see:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">calib_tools</span><span class="o">.</span><span class="n">query_update</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">perform_overlap_removal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>That line grabs the default <em>at the time of the call to <code class="docutils literal notranslate"><span class="pre">query_update</span></code></em> and saves all its values. That occurred during the initial import at the top of the chapter! So us setting this here did nothing! In order to do this, we need to re-run the initial query creation!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">make_ds</span><span class="p">,</span> <span class="n">_samples</span>
<span class="n">redone_ds</span> <span class="o">=</span> <span class="n">make_ds</span><span class="p">(</span><span class="n">_samples</span><span class="p">[</span><span class="s2">&quot;zee&quot;</span><span class="p">])</span>

<span class="n">antikt_jets</span> <span class="o">=</span> <span class="p">(</span><span class="n">redone_ds</span>
               <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">Jets</span><span class="p">())</span>
               <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="n">jets</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">))</span>
               <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="p">{</span>
                       <span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                       <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">eta</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                       <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">phi</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
               <span class="p">})</span>
               <span class="o">.</span><span class="n">AsAwkwardArray</span><span class="p">()</span>
               <span class="o">.</span><span class="n">value</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">pflow_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">antikt_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1108510, 1099565)
</pre></div>
</div>
</div>
</div>
<p>Now we see the expected result - two are different. Again - this is a good reason to use other methods than setting the default. All the pitfalls of global variables will hound you!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">pflow_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PFlow&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">antikt_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AntiKt4&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jet $p_T$ [GeV]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7b95f0dcdacb7fd03468124f366a6019c1e6a3d78918256f149c381998a5713c.png" src="../_images/7b95f0dcdacb7fd03468124f366a6019c1e6a3d78918256f149c381998a5713c.png" />
</div>
</div>
<p>We can further see that if we find closest-matching jets in <span class="math notranslate nohighlight">\(\eta-\phi\)</span>, that the algorithms really do gather different amounts of energy (as expected!):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pflow_matched_jets_to_antikt</span> <span class="o">=</span> <span class="n">match_eta_phi</span><span class="p">(</span><span class="n">antikt_jets</span><span class="p">,</span> <span class="n">pflow_jets</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">pflow_matched_jets_to_antikt</span><span class="o">.</span><span class="n">pt</span> <span class="o">-</span> <span class="n">antikt_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Difference between calibrated PFlow and AntiKt4 jets&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">Delta$ Jet $p_T$ [GeV]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/440cd3159affaa68948f773835aef04562e6160eeea3ae93794249f527c86299.png" src="../_images/440cd3159affaa68948f773835aef04562e6160eeea3ae93794249f527c86299.png" />
</div>
</div>
<p>And then we can use <code class="docutils literal notranslate"><span class="pre">calib_tools.reset_config()</span></code> to reset to factory default. Though this is mostly for test harneses and the like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calib_tools</span><span class="o">.</span><span class="n">reset_config</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">default_config</span></code> is a global variable, so it is fairly dangerous to modify unless you really want to change it for everything.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Modifying the <code class="docutils literal notranslate"><span class="pre">default_collection</span></code> is particularly dangerous in a notebook where one can execute cells out of order. If you execute the cell above to get <code class="docutils literal notranslate"><span class="pre">pflow_jets</span></code> after the <code class="docutils literal notranslate"><span class="pre">antikt_jets</span></code> cell, you’ll get AntiKt4EMToploJets in your pflow jets!</p>
</div>
<div class="admonition-best-practice admonition">
<p class="admonition-title">Best practice</p>
<p>Use this technique if you are setting the calibration once for your analysis in central a configuration file. Otherwise, ignore it.</p>
</div>
</section>
<section id="modifying-the-calibrated-collection-in-the-query">
<h2>Modifying the calibrated collection in the query<a class="headerlink" href="#modifying-the-calibrated-collection-in-the-query" title="Link to this heading">#</a></h2>
<p>You can modify an aspect of the calibration configuration on a query-by-query basis without using the global <code class="docutils literal notranslate"><span class="pre">default_config</span></code>. There are two ways to do this.</p>
<p>First, you can specify the collection to load in place of the default in the <code class="docutils literal notranslate"><span class="pre">Jets</span></code> (or similar) method. This will alter the collection name and run the full calibration. This is useful for quick tests: it is convinent, and keeps the new bank name close to where you make the request - so it is readable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jetname_in_query_jets</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">Jets</span><span class="p">(</span><span class="n">calibrated_collection</span><span class="o">=</span><span class="s2">&quot;AntiKt4EMTopoJets&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="n">jets</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">))</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">eta</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">phi</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
        <span class="p">})</span>
        <span class="o">.</span><span class="n">AsAwkwardArray</span><span class="p">()</span>
        <span class="o">.</span><span class="n">value</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">jetname_in_query_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">antikt_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1099565, 1099565)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ak</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">jetname_in_query_jets</span><span class="o">.</span><span class="n">pt</span> <span class="o">-</span> <span class="n">antikt_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>However, this doesn’t work well if you want to alter more than calibration configuration value.</p>
<p>There is a helper function, <code class="docutils literal notranslate"><span class="pre">calib_tools.query_update</span></code> that allows you to modify values in the calibration configuration. You can also chain the calls, and the modifications will accumulate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">config_jets_in_query_jets</span> <span class="o">=</span> <span class="p">(</span><span class="n">calib_tools</span><span class="o">.</span><span class="n">query_update</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">jet_collection</span><span class="o">=</span><span class="s1">&#39;AntiKt4EMTopoJets&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">Jets</span><span class="p">())</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="n">jets</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">))</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">eta</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">phi</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
        <span class="p">})</span>
        <span class="o">.</span><span class="n">AsAwkwardArray</span><span class="p">()</span>
        <span class="o">.</span><span class="n">value</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ak</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">config_jets_in_query_jets</span><span class="o">.</span><span class="n">pt</span> <span class="o">-</span> <span class="n">antikt_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>Though the code only changes the <code class="docutils literal notranslate"><span class="pre">jet_collection</span></code> you can change as many values in the calibration configuration object as you like in one call. Just add the names as further arguments.</p>
<p>You can even set a whole new configuration if you have lots of changes at once. This will override anything you’ve previously set with <code class="docutils literal notranslate"><span class="pre">query_update</span></code> in the query.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">config_in_query_jets</span> <span class="o">=</span> <span class="p">(</span><span class="n">calib_tools</span><span class="o">.</span><span class="n">query_update</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">new_jet_selection</span><span class="p">,</span> <span class="n">perform_overlap_removal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">Jets</span><span class="p">())</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="n">jets</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">))</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">eta</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">phi</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
        <span class="p">})</span>
        <span class="o">.</span><span class="n">AsAwkwardArray</span><span class="p">()</span>
        <span class="o">.</span><span class="n">value</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ak</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">config_in_query_jets</span><span class="o">.</span><span class="n">pt</span> <span class="o">-</span> <span class="n">antikt_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<div class="admonition-best-practice admonition">
<p class="admonition-title">Best practice</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">query_update</span></code> for most cases. It has maximum flexibility and composability. In your analysis, where you declare the dataset, you can easily add a call to <code class="docutils literal notranslate"><span class="pre">calib_tools.query_update</span></code>, for example. You can also modify a query on the fly if you need to alter the calibration configuration for some reason.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">calibrated_collection</span></code> argument in a collection request if want to run a one-off test of just a collection change.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">calib_tools.set_default_config</span></code> only if you are going to be using this new configuration for everything that will ever be done, and only if you are sure the configuration file being loaded will always by loaded by everyone in the analysis team.</p></li>
</ul>
</div>
</section>
<section id="systematic-errors">
<h2>Systematic Errors<a class="headerlink" href="#systematic-errors" title="Link to this heading">#</a></h2>
<p>You can only query a single systematic error at a time. You do this by specifying the systematic error you want using the helper method <code class="docutils literal notranslate"><span class="pre">calib_tools.query_sys_error</span></code>. By default, the central value is returned (<code class="docutils literal notranslate"><span class="pre">NOSYS</span></code>). You will need to know the names of the systematic errors a head of time in order to use this.</p>
<p>Here we get jets for evaluated for the systematic error <code class="docutils literal notranslate"><span class="pre">JET_Pileup_PtTerm_1up</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys_jets</span> <span class="o">=</span> <span class="p">(</span><span class="n">calib_tools</span><span class="o">.</span><span class="n">query_sys_error</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s1">&#39;JET_Pileup_PtTerm__1up&#39;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">Jets</span><span class="p">())</span>
            <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="n">jets</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">))</span>
            <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">eta</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                    <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">phi</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
            <span class="p">})</span>
            <span class="o">.</span><span class="n">AsAwkwardArray</span><span class="p">()</span>
            <span class="o">.</span><span class="n">value</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>And we can compare the values to see how big a correction this is by doing the <span class="math notranslate nohighlight">\(\eta-\phi\)</span> matching:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys_jet_matched</span> <span class="o">=</span> <span class="n">match_eta_phi</span><span class="p">(</span><span class="n">pflow_jets</span><span class="p">,</span> <span class="n">sys_jets</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">pflow_jets</span><span class="o">.</span><span class="n">pt</span> <span class="o">-</span> <span class="n">sys_jet_matched</span><span class="o">.</span><span class="n">pt</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Effect of the Systematic Error JET_Pileup_PtTerm__1up&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">Delta$ Jet $p_T$ [GeV]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c6edffb8ce2b726a5e45e28c67a45fab68f018b48b4a87a224614837a6c58b21.png" src="../_images/c6edffb8ce2b726a5e45e28c67a45fab68f018b48b4a87a224614837a6c58b21.png" />
</div>
</div>
<p>While this works, it clearly can’t be the final way to do this. Espeically given the push model that ATLAS uses for systematic errors. Thoughts welcome at this <a class="reference external" href="https://github.com/gordonwatts/xaod_usage/issues/13">issue on how to implement systematic errors</a> in the ATLAS xAOD system for <code class="docutils literal notranslate"><span class="pre">func_adl</span></code>.</p>
</section>
<section id="uncalibrated-collections">
<h2>Uncalibrated Collections<a class="headerlink" href="#uncalibrated-collections" title="Link to this heading">#</a></h2>
<p>You can also request an uncalibrated jet bank - so you can look at the “raw” data. For example, we can compare the overlap and calibrated jets above with the jets in the actual starting bank:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">default_jets</span> <span class="o">=</span> <span class="n">calib_tools</span><span class="o">.</span><span class="n">default_config</span><span class="p">()</span><span class="o">.</span><span class="n">jet_collection</span>
<span class="n">uncalibrated_jets</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">Jets</span><span class="p">(</span><span class="n">uncalibrated_collection</span><span class="o">=</span><span class="n">default_jets</span><span class="p">))</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="n">jets</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">))</span>
        <span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jets</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">pt</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">eta</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
                <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">phi</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jets</span><span class="p">],</span>
        <span class="p">})</span>
        <span class="o">.</span><span class="n">AsAwkwardArray</span><span class="p">()</span>
        <span class="o">.</span><span class="n">value</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">uncalibrated_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Raw PFlow&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">pflow_jets</span><span class="o">.</span><span class="n">pt</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PFlow&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jet $p_T$ [GeV]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/99aecccfcc3fdee804104fab9ef3a560be4da5bde06ef864dfce20bda534dc6e.png" src="../_images/99aecccfcc3fdee804104fab9ef3a560be4da5bde06ef864dfce20bda534dc6e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncalibrated_matched</span> <span class="o">=</span> <span class="n">match_eta_phi</span><span class="p">(</span><span class="n">pflow_jets</span><span class="p">,</span> <span class="n">uncalibrated_jets</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ak</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">pflow_jets</span><span class="o">.</span><span class="n">pt</span> <span class="o">-</span> <span class="n">uncalibrated_matched</span><span class="o">.</span><span class="n">pt</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Effect of Calibration on the Jet Collection&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">Delta$ Jet $p_T$ [GeV]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6a6848e28df1635c1b082dea63bc997980f904c0c36e1009267ec164914915ff.png" src="../_images/6a6848e28df1635c1b082dea63bc997980f904c0c36e1009267ec164914915ff.png" />
</div>
</div>
</section>
<section id="analysisbase-configuration-code">
<h2>AnalysisBase Configuration Code<a class="headerlink" href="#analysisbase-configuration-code" title="Link to this heading">#</a></h2>
<p>Everyone familiar with AnalysisBase will recognize that the <code class="docutils literal notranslate"><span class="pre">func_adl_xAOD</span></code> system must at some level configuring, via python, the common CP tools. The design of the calibration system here potentially allows you to modify that python code as you wish. However, an API has <a class="reference external" href="https://github.com/gordonwatts/xaod_usage/issues/14">not yet been developed</a> to do this easily.</p>
<p>If you are curious about exactly what code is being downloaded, feel free to look at the template files located in the <code class="docutils literal notranslate"><span class="pre">templates</span></code> directory in the <code class="docutils literal notranslate"><span class="pre">func_adl_servicex_xaodr21</span></code> package that is installed in your environment.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="further-information">
<h1>Further Information<a class="headerlink" href="#further-information" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">func_adl_servicex_xaodr21</span> <span class="kn">import</span> <span class="n">CalibrationEventConfig</span>
<span class="n">help</span><span class="p">(</span><span class="n">CalibrationEventConfig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on class CalibrationEventConfig in module func_adl_servicex_xaodr21.calibration_support:

class CalibrationEventConfig(builtins.object)
 |  CalibrationEventConfig(jet_collection: str, jet_calib_truth_collection: str, electron_collection: str, electron_working_point: str, electron_isolation: str, photon_collection: str, photon_working_point: str, photon_isolation: str, muon_collection: str, muon_working_point: str, muon_isolation: str, tau_collection: str, tau_working_point: str, perform_overlap_removal: bool) -&gt; None
 |  
 |  CalibrationEventConfig(jet_collection: str, jet_calib_truth_collection: str, electron_collection: str, electron_working_point: str, electron_isolation: str, photon_collection: str, photon_working_point: str, photon_isolation: str, muon_collection: str, muon_working_point: str, muon_isolation: str, tau_collection: str, tau_working_point: str, perform_overlap_removal: bool)
 |  
 |  Methods defined here:
 |  
 |  __eq__(self, other)
 |  
 |  __init__(self, jet_collection: str, jet_calib_truth_collection: str, electron_collection: str, electron_working_point: str, electron_isolation: str, photon_collection: str, photon_working_point: str, photon_isolation: str, muon_collection: str, muon_working_point: str, muon_isolation: str, tau_collection: str, tau_working_point: str, perform_overlap_removal: bool) -&gt; None
 |  
 |  __repr__(self)
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
 |  
 |  ----------------------------------------------------------------------
 |  Data and other attributes defined here:
 |  
 |  __annotations__ = {&#39;electron_collection&#39;: &lt;class &#39;str&#39;&gt;, &#39;electron_iso...
 |  
 |  __dataclass_fields__ = {&#39;electron_collection&#39;: Field(name=&#39;electron_co...
 |  
 |  __dataclass_params__ = _DataclassParams(init=True,repr=True,eq=True,or...
 |  
 |  __hash__ = None
 |  
 |  __slotnames__ = []
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">calib_tools</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on class calib_tools in module func_adl_servicex_xaodr21.calibration_support:

class calib_tools(builtins.object)
 |  Helper functions to work with a query&#39;s calibration configuration.
 |  
 |  Class methods defined here:
 |  
 |  default_config() -&gt; func_adl_servicex_xaodr21.calibration_support.CalibrationEventConfig from builtins.type
 |      Return a copy of the current default calibration configuration.
 |  
 |  default_sys_error() -&gt; str from builtins.type
 |      Return the default systematic error
 |  
 |  query_get(query: func_adl.object_stream.ObjectStream[~T]) -&gt; func_adl_servicex_xaodr21.calibration_support.CalibrationEventConfig from builtins.type
 |      Return a copy of the calibration if the query were issued at this point.
 |      
 |      Args:
 |          query (ObjectStream[T]): The query to inspect.
 |      
 |      Returns:
 |          CalibrationEventConfig: The calibration configuration for the query.
 |  
 |  query_sys_error(query: func_adl.object_stream.ObjectStream[~T], sys_error: str) -&gt; func_adl.object_stream.ObjectStream[~T] from builtins.type
 |      Add metadata to a query to indicate a change in the systematic error for the events.
 |      
 |      Args:
 |          query (ObjectStream[T]): The query to update.
 |      
 |          sys_error (str): The systematic error to fetch. Only a single one is possible at any time. The sys error names
 |              are the same as used by the common CP algorithms.
 |      
 |      Returns:
 |          ObjectStream[T]: The updated query.
 |      
 |      Notes:
 |      
 |          * This function can be chained - resolution works by looking at the most recent `query_sys_error` in the query.
 |  
 |  query_update(query: func_adl.object_stream.ObjectStream[~T], calib_config: Optional[func_adl_servicex_xaodr21.calibration_support.CalibrationEventConfig] = None, **kwargs) -&gt; func_adl.object_stream.ObjectStream[~T] from builtins.type
 |      Add metadata to a query to indicate a change in the calibration configuration for the query.
 |      
 |      Args:
 |          query (ObjectStream[T]): The query to update.
 |      
 |          calib_config (Optional[CalibrationEventConfig]): The new calibration configuration to use. If specified
 |              will override all calibration configuration options in the query.
 |      
 |          jet_collection, ...: Use any property name from the `CalibrationEventConfig` class to override that particular
 |              options for this query. You may specify as many of them as you like.
 |      
 |      Returns:
 |          ObjectStream[T]: The updated query.
 |      
 |      Notes:
 |      
 |          * This function can be chained - resolution works by looking at the most recent `query_update` in the query.
 |          * This function works by storing a complete `CalibrationEventConfig` object, updated as requested, in the query. So
 |              even if you just update `jet_collection`, changing the `default_config` after calling this will have no effect.
 |  
 |  reset_config() from builtins.type
 |      Reset calibration config to the default.
 |      
 |      * This is configured for working with R21 DAOD_PHYS samples.
 |  
 |  reset_sys_error() from builtins.type
 |      Reset to &#39;NOSYS&#39; the default systematic error
 |  
 |  set_default_config(config: func_adl_servicex_xaodr21.calibration_support.CalibrationEventConfig) from builtins.type
 |      Store a copy of a new default config for use in all future queries.
 |  
 |  set_default_sys_error(value: str) from builtins.type
 |      Set the default systematic error
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
 |  
 |  ----------------------------------------------------------------------
 |  Data and other attributes defined here:
 |  
 |  __annotations__ = {&#39;_default_calibration&#39;: typing.Optional[func_adl_se...
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="jets.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">The Jet Collection</p>
      </div>
    </a>
    <a class="right-next"
       href="electrons.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The Electron Collection</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Calibration</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-calibration-configuration-object">The Calibration Configuration Object</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modifying-the-calibrated-collection-in-the-query">Modifying the calibrated collection in the query</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#systematic-errors">Systematic Errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncalibrated-collections">Uncalibrated Collections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysisbase-configuration-code">AnalysisBase Configuration Code</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#further-information">Further Information</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By IRIS-HEP (Gordon Watts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>